/*! paintbucket - v0.1.0 - 2016-03-12
* Copyright (c) 2016 Erik Wibowo; Licensed MIT */
!function(a){var b={},c="#ffff00",d="active",e="fill-color",f="paintbucket-active";a.Paintbucket=function(g,h,j){var k=j&&j.cursor?j.cursor:"pointer",l=a(g);l.data(e,c),l.data(f,d);var m=a(h).get(0);if(!(m instanceof HTMLCanvasElement))throw new TypeError("Invalid element type. Only usable on HTMLCanvasElement.");var n=m,o=n.getContext("2d"),p=window.devicePixelRatio||1,q=o.webkitBackingStorePixelRatio||o.mozBackingStorePixelRatio||o.msBackingStorePixelRatio||o.oBackingStorePixelRatio||o.backingStorePixelRatio||1,r=p/q,s=n.getBoundingClientRect().width*r,t=n.getBoundingClientRect().height*r;n.width=s,n.height=t;var u=function(a){i(n,"cursor","progress");var c=n.getBoundingClientRect(),d=n.width,f=n.height,g=c.top,h=Math.floor(c.left),j=o.getImageData(0,0,d,f),m=b.getFirstComponentIndexOfPixelAtXY((a.clientX-h)*r,(a.clientY-g)*r,d),p={r:j.data[m],g:j.data[m+1],b:j.data[m+2],a:j.data[m+3]},q=l.data(e);b.applyColor(j,q,p,m),o.putImageData(j,0,0),i(n,"cursor",k)};return l.click(function(){a(this).data(f)===d?(a(this).data(f,""),n.removeEventListener("click",u),i(n,"cursor","default")):(a(this).data(f,d),n.addEventListener("click",u),i(n,"cursor",k))}),this},b.applyColor=function(a,b,c,d){var e=h(b.replace("#",""));g(d,a,c,e)};var g=function(a,c,d,e){for(var f=4*c.width,g=a,h=b.calcLeftBoundary(g,f),i=b.calcRightBoundary(g,f),j=[a];j.length;){for(g=j.pop();b.equalsColorAtClickedSpotAndNotPickedColor(c,g,d,e);)g-=f,h=b.calcLeftBoundary(g,f),i=b.calcRightBoundary(g,f);for(g+=f,h=b.calcLeftBoundary(g,f),i=b.calcRightBoundary(g,f);b.equalsColorAtClickedSpotAndNotPickedColor(c,g,d,e);)c.data[g]=e.r,c.data[g+1]=e.g,c.data[g+2]=e.b,c.data[g+3]=255,g>=h&&b.equalsColorAtClickedSpotAndNotPickedColor(c,g-4,d,e)&&j.push(g-f-4),i>g&&b.equalsColorAtClickedSpotAndNotPickedColor(c,g+4,d,e)&&j.push(g-f+4),g+=f,h=b.calcLeftBoundary(g,f),i=b.calcRightBoundary(g,f)}};b.calcLeftBoundary=function(a,b){return a-a%b},b.calcRightBoundary=function(a,c){return b.calcLeftBoundary(a,c)+c},b.equalsColorAtClickedSpotAndNotPickedColor=function(a,c,d,e){return b.colorEquals(a,c,d)&&!b.colorEquals(a,c,e)},b.colorEquals=function(a,c,d){return b.isZeroTransparent(a.data[c],a.data[c+1],a.data[c+2],a.data[c+3])?b.isZeroTransparent(d.r,d.g,d.b,d.a):a.data[c]===d.r&&a.data[c+1]===d.g&&a.data[c+2]===d.b},b.isZeroTransparent=function(a,b,c,d){return 0===a&&0===b&&0===c&&0===d},b.getFirstComponentIndexOfPixelAtXY=function(a,b,c){return 4*(b*c+a)};var h=function(a){var b=/^(..)(..)(..)$/.exec(a);if(b){var c=b.slice(1).map(function(a){return parseInt(a,16)});return{r:c[0],g:c[1],b:c[2]}}},i=function(a,b,c){a.style[b]=c};a.fn.paintbucket=function(c,d){return this.each(function(){new a.Paintbucket(this,c,d),d&&d.exposeInternals&&a(this).data("internals",b)})}}(jQuery);